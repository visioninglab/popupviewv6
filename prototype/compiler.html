<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MindAR Target Compiler</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 600px; margin: 40px auto; padding: 0 20px; background: #1a1a2e; color: #e0e0e0; }
    h1 { color: #00d4ff; }
    .step { background: #16213e; border-radius: 8px; padding: 20px; margin: 16px 0; }
    .step h2 { color: #00d4ff; margin-top: 0; font-size: 1.1em; }
    img { max-width: 300px; border-radius: 4px; margin: 10px 0; }
    button { background: #00d4ff; color: #1a1a2e; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold; }
    button:hover { background: #00b8d9; }
    button:disabled { background: #555; cursor: not-allowed; }
    #status { color: #ffd700; margin: 10px 0; }
    #progress { color: #00ff88; }
  </style>
</head>
<body>
  <h1>MindAR Target Compiler</h1>
  <p>Compiles your trigger image into a .mind file for AR image tracking.</p>

  <div class="step">
    <h2>Step 1: Preview trigger image</h2>
    <img id="preview" src="assets/trigger.png" alt="Trigger image">
    <p>This is the BugsInTheWoods trigger image that the AR experience will detect.</p>
  </div>

  <div class="step">
    <h2>Step 2: Compile</h2>
    <button id="compileBtn" onclick="compile()">Compile to .mind file</button>
    <div id="status"></div>
    <div id="progress"></div>
  </div>

  <div class="step" id="downloadStep" style="display:none">
    <h2>Step 3: Download</h2>
    <a id="downloadLink"><button>Download targets.mind</button></a>
    <p>Save this file into the <code>assets/</code> folder.</p>
  </div>

  <script type="module">
    // MindAR image compiler from CDN
    import { MindARImageCompiler } from 'https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image.prod.mjs';

    window.compile = async function() {
      const btn = document.getElementById('compileBtn');
      const status = document.getElementById('status');
      const progress = document.getElementById('progress');

      btn.disabled = true;
      status.textContent = 'Loading image...';

      try {
        // Load the trigger image
        const img = new Image();
        img.crossOrigin = 'anonymous';
        await new Promise((resolve, reject) => {
          img.onload = resolve;
          img.onerror = reject;
          img.src = 'assets/trigger.png';
        });

        status.textContent = 'Compiling target (this may take 30-60 seconds)...';

        const compiler = new MindARImageCompiler();
        await compiler.compileImageTargets([img], (p) => {
          progress.textContent = `Progress: ${Math.round(p)}%`;
        });

        const exportedBuffer = await compiler.exportData();
        const blob = new Blob([exportedBuffer], { type: 'application/octet-stream' });
        const url = URL.createObjectURL(blob);

        const downloadLink = document.getElementById('downloadLink');
        downloadLink.href = url;
        downloadLink.download = 'targets.mind';
        document.getElementById('downloadStep').style.display = 'block';

        status.textContent = 'Done! Download the file and place it in the assets/ folder.';
        progress.textContent = '';
      } catch (err) {
        status.textContent = 'Error: ' + err.message;
        console.error(err);
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
